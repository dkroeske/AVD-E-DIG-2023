/* cmsis FIR */

#include "process.h"
#include "arm_math.h"
#include "fir.h"

/* #define CONVDIRECT_KERNEL_GAIN  1.00f
#define CONVDIRECT_KERNEL_LENGHT 55 //FILTER_TAP_NUM

typedef struct {
    arm_fir_instance_f32 firProcessor;
    float firBuf[CONVDIRECT_KERNEL_LENGHT + BLOCK_SIZE - 1];
    float kernelTimeReversed[CONVDIRECT_KERNEL_LENGHT];
    float out[BLOCK_SIZE];
} ConvDirect_Container;

// filter coeficients
extern const float ConvDirect_Kernel[CONVDIRECT_KERNEL_LENGHT];

void ConvDirect_Init(ConvDirect_Container *c, const float *kernel);
void ConvDirect_Update(ConvDirect_Container *c, float *inp);
*/


void ConvDirect_Init(ConvDirect_Container *c, const float *kernel) {
    
    /* 
        Prepare time reversed filter coefficients 
    */
    for(uint16_t idx = 0; idx < CONVDIRECT_KERNEL_LENGHT; idx++) {
        c->kernelTimeReversed[idx] = CONVDIRECT_KERNEL_GAIN * kernel[CONVDIRECT_KERNEL_LENGHT - idx - 1];
    }

    arm_fir_init_f32( &(c->firProcessor), CONVDIRECT_KERNEL_LENGHT, c->kernelTimeReversed, c->firBuf, BLOCK_SIZE );
}

void ConvDirect_Update(ConvDirect_Container *c, float *inp) {
    arm_fir_f32( &(c->firProcessor), inp, c->out, BLOCK_SIZE);
}


const float ConvDirect_Kernel[CONVDIRECT_KERNEL_LENGHT] = {
  0.005622617771859415,
  0.0008181245114450673,
  -0.0018810332112238393,
  -0.005469373124941626,
  -0.0081677147179748,
  -0.008367507304810855,
  -0.005684693451448137,
  -0.0014405600780646936,
  0.0019051147433269565,
  0.002237491483891595,
  -0.0005787268299740354,
  -0.003982634452230274,
  -0.003655360226127373,
  0.004018839492189421,
  0.019122367616348945,
  0.03663213112698483,
  0.04747529545543478,
  0.04229660272353813,
  0.01647789356540496,
  -0.026021152397639323,
  -0.07227478399830374,
  -0.10438321609148754,
  -0.10665491058366268,
  -0.07285527752644962,
  -0.010294803047330017,
  0.061696969732646906,
  0.11858873691366947,
  0.14015359795491672,
  0.11858873691366947,
  0.061696969732646906,
  -0.010294803047330017,
  -0.07285527752644962,
  -0.10665491058366268,
  -0.10438321609148754,
  -0.07227478399830374,
  -0.026021152397639323,
  0.01647789356540496,
  0.04229660272353813,
  0.04747529545543478,
  0.03663213112698483,
  0.019122367616348945,
  0.004018839492189421,
  -0.003655360226127373,
  -0.003982634452230274,
  -0.0005787268299740354,
  0.002237491483891595,
  0.0019051147433269565,
  -0.0014405600780646936,
  -0.005684693451448137,
  -0.008367507304810855,
  -0.0081677147179748,
  -0.005469373124941626,
  -0.0018810332112238393,
  0.0008181245114450673,
  0.005622617771859415
};







